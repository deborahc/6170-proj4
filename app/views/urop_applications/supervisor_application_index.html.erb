<%= link_to 'New UROP Posting', new_posting_path, :style=>"margin:20px;" %><br>
<%= link_to 'View all Postings', postings_path, :style=>"margin:20px" %>

<center><h3><%=current_user.first_name+" "+current_user.last_name%>'s UROP postings</h3></center>

<% current_user.postings.each_slice(3) do |slice| %>
  <div class="row-fluid">
  <% slice.each do |posting| %>
  <div class="span4">
    <h4> <%= posting.title %></h4>
    <p>Sponsor: <%= posting.supervisor.first_name %> <%= posting.supervisor.last_name %></p>
    <p>Project description: <%= posting.description %></p>
    <p>Skills: <%= posting.skills %></p>
    <p>Funding type: <%= posting.funding_type %></p>

    <!-- Only give users the option to see delete button for postings that they created, validated by can_delete anyway-->
    <% if posting.supervisor_id == current_user.id %>
      <div style="float:left;">
        <%= button_to( 'Delete', posting, method: :delete, :class => 'btn btn-med btn-primary', data: { confirm: 'Are you sure?' } )%>
      </div>

          <div style="float:left;">
      <%= button_to('Edit', edit_posting_path(posting), :class => 'btn btn-med btn-primary', :method => :get) %>
    </div>
    <% end %>
	<br>
  <br>
	<h4> Applications </h4>
	<% if posting.urop_applications.empty? %>
		<p> No applications </p>
	<% end %>
	<% posting.urop_applications.each do |application| %>
		<div class="well">
		<%= link_to application.student.first_name+" "+application.student.last_name, student_path(application.student.id) %><br>
		Contact info: <%= application.student.email %><br>
		<%= application.message %><br><br>
    <button class="btn btn-success btn-sm" data-toggle="modal" data-target="#reply-modal<%=application.id%>">
      Send an Email
    </button>
		</div>
    <!-- Modal -->
    <div class="modal fade" id="reply-modal<%=application.id%>" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
          <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
            <h4 class="modal-title" id="myModalLabel">New Email</h4><br>
            <p class="modal-title">To: <%=application.student.email%></p><br>
            <p class="modal-title">From: <%=current_user.email%></p><br>
          </div>
          <textarea class="modal-body">
          </textarea>
          <div class="modal-footer">
            <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
            <%= link_to "Send Message", email_path(application), class: "btn btn-default" %>
          </div>
    </div><!-- /.modal -->
	<% end %>
  </div>
  <% end %><!--/span-->
</div>
<% end %>